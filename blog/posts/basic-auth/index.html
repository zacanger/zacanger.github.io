<!DOCTYPE html>
<html lang="en">

  <head>
    <title>basic auth | Zac Anger's Blog</title>
    <meta name="description" content="basic auth" />
    <meta name="keywords" content="['auth', 'node', 'js', 'passport']" />
    <meta name="twitter:description" content="basic auth" />
    <meta name="twitter:title" content="basic auth" />
    <meta property="og:description" content="basic auth" />
    <meta property="og:title" content="basic auth" />

    <meta charset="utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<meta name="author" content="Zac Anger" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@zacanger" />
<meta name="twitter:creator" content="@zacanger" />
<meta name="twitter:image" content="https://zacanger.com/logo.png" />
<meta property="og:type" content="article" />
<meta property="og:site_name" content="Zac Anger's Blog" />
<meta property="og:image" content="https://zacanger.com/logo.png" />
<link rel="stylesheet" type="text/css" href="/styles.css" />
  </head>

  <body>
    <header>
      <h1><a href="/blog">Zac Anger's Blog</a></h1>
      <h2>basic auth</h2>
      <h3>2016-02-12</h3>
      <h4><small>Tagged: auth, node, js, passport</small></h4>
    </header>
    <div>
      <ul>
<li>Basic HTTP:</li>
<li>restricted based on system user/pass</li>
<li><a href="http://zacanger:encryptedpassword@zacanger.com">http://zacanger:encryptedpassword@zacanger.com</a></li>
<li>Form-based:</li>
<li>restricted based on cookies</li>
<li>success = stored cookie on client</li>
<li><code>POST whatever.com/login (headers)</code></li>
<li>Token-based:</li>
<li>requests with auth token</li>
<li><a href="https://foo.bar/whatever?auth_token=asdfghjkl123456789">https://foo.bar/whatever?auth_token=asdfghjkl123456789</a></li>
<li>OAuth</li>
<li>rate limited, expired, revoked server-side</li>
<li>Passport</li>
<li>this is, clearly, the preferred method, both with devmtn and with express in general, i feel</li>
</ul>
<hr />
<div class="highlight"><pre><span></span><span class="c1">// npm i -S the things we&#39;re requiring right here</span>

<span class="kd">var</span> <span class="nx">express</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">session</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-session&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">passport</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">Facebook</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport-facebook&#39;</span><span class="p">).</span><span class="nx">Strategy</span>
  <span class="p">,</span> <span class="nx">app</span>      <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
  <span class="p">,</span> <span class="nx">port</span>     <span class="o">=</span> <span class="mi">3000</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">initialize</span><span class="p">())</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">session</span><span class="p">())</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">new</span> <span class="nx">Facebook</span><span class="p">({</span>
  <span class="p">,</span> <span class="nx">callbackURL</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/auth/facebook/callback&#39;</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="nx">refreshToken</span><span class="p">,</span> <span class="nx">profile</span><span class="p">,</span> <span class="nx">done</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">profile</span><span class="p">)</span>
<span class="p">}))</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/auth/facebook&#39;</span><span class="p">,</span> <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s1">&#39;facebook&#39;</span><span class="p">))</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/auth/facebook/callback&#39;</span><span class="p">,</span> <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s1">&#39;facebook&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">successRedirect</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span>
  <span class="p">,</span> <span class="nx">failureRedirect</span><span class="o">:</span> <span class="s1">&#39;/login&#39;</span>
<span class="p">}),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="s1">&#39;http://zacanger.com/gifland/ferret-fail.gif&#39;</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">serializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">done</span><span class="p">){</span>
  <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">deserializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">done</span><span class="p">){</span>
  <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/me&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">ers</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">currentUser</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;oi oi oi at &#39;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
    </div>
    <footer>
  <a href="/">Zac Anger</a>
  &middot; <a href="https://github.com/zacanger/zacanger.github.io">Source</a>
</footer>
  </body>
</html>