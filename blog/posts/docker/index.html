<!DOCTYPE html>
<html lang="en">

  <head>
    <title>docker notes | Zac Anger's Blog</title>
    <meta name="description" content="docker notes" />
    <meta name="keywords" content="['docker']" />
    <meta name="twitter:description" content="docker notes" />
    <meta name="twitter:title" content="docker notes" />
    <meta property="og:description" content="docker notes" />
    <meta property="og:title" content="docker notes" />

    <meta charset="utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<meta name="author" content="Zac Anger" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@zacanger" />
<meta name="twitter:creator" content="@zacanger" />
<meta name="twitter:image" content="https://zacanger.com/logo.png" />
<meta property="og:type" content="article" />
<meta property="og:site_name" content="Zac Anger's Blog" />
<meta property="og:image" content="https://zacanger.com/logo.png" />
<link rel="stylesheet" type="text/css" href="/styles.css" />
  </head>

  <body>
    <header>
      <h1><a href="/blog">Zac Anger's Blog</a></h1>
      <h2>docker notes</h2>
      <h3>2016-05-26</h3>
      <h4><small>Tags: docker</small></h4>
    </header>
    <hr>
    <div>
      <p>So this is a <code>Dockerfile</code>:</p>
<pre><code>FROM ubuntu:latest
RUN # any commands, for example
RUN apt-get update
RUN apt-get dist-upgrade -y -allow-unauthenticated --fix-missing
RUN apt-get install build-essential curl
RUN curl https://gist.githubusercontent.com/isaacs/579814/raw/24f5f02b5cd1812ebb1c41a33a13a0417cccbd69/take-ownership.sh | bash
EXPOSE 4010 # port to expose
ENTRYPOINT [&quot;node&quot;] # thing to run when we start the image, i think
</code></pre>
<p>and then we do something like <code>docker build -t whatwewanttocallit .</code></p>
<p>and then <code>docker run -d 4010:4010 whatwecalledit</code></p>
<p>It looks like the <code>argon:node</code> image is one that is a thing. Nodejs.org
recommends it.</p>
<p>Some other Dockerfile commands (?):</p>
<pre><code>WORKDIR /set/working/directory/to/here/i/guess
COPY thisthing /to/here
CMD [&quot;array&quot;, &quot;of&quot;, &quot;commands&quot;, &quot;like&quot;, &quot;npm&quot;, &quot;start&quot;]
ADD . . # add files/dirs from cwd to image
</code></pre>
<p>The <code>-d</code> in <code>docker run -d</code> means <code>detach</code>. And <code>-p</code> as in <code>docker run -p
80:4010</code> looks obvious.</p>
<p>Some commands:</p>
<pre><code>docker ps # get container id
docker logs containerid
docer exec -it containerid /bin/bash # enter the container
</code></pre>
<p>It's totally fine to test against ports from a container (with eg <code>cURL</code>).</p>
<p>There's also a <code>node:versionnumber</code> image I think?</p>
<p>To get non-root users: <code>RUN groupadd -r app &amp;&amp; useradd -r -g app app</code>,
then when the image is run, do it with <code>-u "app"</code>.</p>
<p>To limit usage: <code>-m "256M" --memory-swap "2G"</code></p>
<p>An example:</p>
<pre><code class="language-shell">docker run \
-e &quot;NODE_ENV=production&quot; \
-u &quot;app&quot; \
-m &quot;256M&quot; --memory-swap &quot;2G&quot; \
-w &quot;/web/jane-com/app&quot; \
--name &quot;jane-com&quot; \
node index.js
</code></pre>
<p>Installing (on nix): <code>curl https://get.docker.com/ | sh</code></p>
<p>Installing test version: <code>curl https://test.docker.com | sh</code></p>
<p>Installing dev version: <code>curl https://experimental.docker.com | sh</code></p>
<p>Compose is like fig, but from Docker.</p>
<pre><code>pip install -U docker-compose
docker-compose up -d
docker-compose stop, kill, rm
</code></pre>
<p>All of these just go off a YAML file, I guess.</p>
<p>Okay, based on Node's official docs we can do:</p>
<pre><code>FROM node:6.2.0
EXPOSE 4010

# and then

docker build -t jane-com .
docker run -it --rm -name jane-com-docker-running jane-com
</code></pre>
<p>To keep Docker running, throw this in your bash rc: <code>eval $(docker-machine env
default)</code></p>
<p>And if you need systemd in the mix, try something like:</p>
<pre><code>;; once docker is installed, there should already be
;; a systemd service for it. so you can just systemctl start docker
;; and systemctl enable docker and that SHOULD be it

[Unit]
Description=This is our Node service
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStartPre=/usr/bin/docker kill ournodecontainer
ExecStartPre=/usr/bin/docker rm ournodecontainer
ExecStart=/usr/bin/docker run --name=ournodecontainer ournode/container
ExecStop=/usr/bin/docker stop ournodecontainer

[Install]
WantedBy=multi-user.target
</code></pre>
<p><strong>TO GET YOUR IMAGE INTO A TARBALL, LOCALLY</strong> (because they don't really tell
you where to look for that):</p>
<pre><code class="language-shell">docker export &lt;container-hash&gt; &gt; dockerimg.tar

# And then you could just:

mkdir ~/foo
tar -C ~/foo -xvf dockerimg.tar

# (or just use atool's aunpack, much easier to remember!)
</code></pre>
<p>Docker can take a <code>.dockerignore</code>, formatted I guess basically the same as gitignore.</p>
<p>Doing an <code>export</code> piped to an <code>import</code> essentially works like a squash,
flattening all the layers, so extraneous info (for example, creating files that
later get removed) wouldn't take up extra space.</p>
<p><code>docker export</code> is for <em>containers</em>, currently running.</p>
<p><code>docker save</code> is for <em>images</em>.</p>
    </div>
    <footer>
  <a href="/">Zac Anger</a>
  &middot; <a href="https://github.com/zacanger/zacanger.github.io">Source</a>

  &middot;

  Support on
  <a href="https://ko-fi.com/zacanger" title="Ko-fi" rel="nofollow
  noopener noreferrer" target="_blank">Ko-fi</a>,
  <a href="https://paypal.me/zacanger" title="PayPal" rel="nofollow noopener noreferrer" target="_blank">PayPal</a> or
  <a href="https://www.patreon.com/zacanger" title="Patreon" rel="nofollow noopener noreferrer" target="_blank">Patreon</a>
</footer>
  </body>
</html>